<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Car Price Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<div class="overlay-gradient"></div>

<div class="container py-5">

  <!-- Predictor  -->
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      <div class="card hero-card p-4 p-md-5">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
          <h1 class="brand-title m-0">üöó Car Price Predictor</h1>
          <span class="badge badge-soft-light fs-6">
            Model: <strong>{{ model_name }}</strong>
          </span>
        </div>
        <p class="text-hero-subtle mb-4">
          Fill the details below to estimate a fair selling price. Use the Reset button to clear the form.
        </p>

        <form method="post" action="/" class="row g-3">
          <div class="col-md-6">
            <label class="form-label text-hero">Present Price (lakhs)</label>
            <input
              type="number" step="0.01" min="0"
              class="form-control form-control-lg input-soft"
              name="Present_Price"
              placeholder="e.g., 5.59"
              value="{{ form.Present_Price or '' }}"
              required
            >
          </div>

          <div class="col-md-6">
            <label class="form-label text-hero">Kms Driven</label>
            <input
              type="number" step="1" min="0"
              class="form-control form-control-lg input-soft"
              name="Kms_Driven"
              placeholder="e.g., 27000"
              value="{{ form.Kms_Driven or '' }}"
              required
            >
          </div>

          <div class="col-md-4">
            <label class="form-label text-hero">Fuel Type</label>
            <select class="form-select form-select-lg input-soft" name="Fuel_Type" required>
              <option value="" disabled {% if not form.Fuel_Type %}selected{% endif %}>Select fuel</option>
              {% for opt in fuel_options %}
                <option value="{{opt}}" {% if form.Fuel_Type == opt %}selected{% endif %}>{{opt}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label text-hero">Seller Type</label>
            <select class="form-select form-select-lg input-soft" name="Seller_Type" required>
              <option value="" disabled {% if not form.Seller_Type %}selected{% endif %}>Select seller</option>
              {% for opt in seller_options %}
                <option value="{{opt}}" {% if form.Seller_Type == opt %}selected{% endif %}>{{opt}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label text-hero">Transmission</label>
            <select class="form-select form-select-lg input-soft" name="Transmission" required>
              <option value="" disabled {% if not form.Transmission %}selected{% endif %}>Select transmission</option>
              {% for opt in transmission_options %}
                <option value="{{opt}}" {% if form.Transmission == opt %}selected{% endif %}>{{opt}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label text-hero">Owner Count</label>
            <input
              type="number" step="1" min="0"
              class="form-control form-control-lg input-soft"
              name="Owner"
              placeholder="e.g., 0"
              value="{{ form.Owner or '' }}"
              required
            >
          </div>

          <div class="col-md-6">
            <label class="form-label text-hero">Age (years)</label>
            <input
              type="number" step="1" min="0"
              class="form-control form-control-lg input-soft"
              name="Age"
              placeholder="e.g., 8"
              value="{{ form.Age or '' }}"
              required
            >
          </div>

          <div class="col-12 d-flex flex-wrap align-items-center gap-3 mt-2">
            <button class="btn btn-gradient btn-lg px-4" type="submit">Predict</button>
            <button class="btn btn-outline-light btn-lg px-4" type="reset">Reset Form</button>

            {% if prediction is not none %}
              <span class="pill result-chip">
                Latest Prediction: <strong>{{ prediction }}</strong>
              </span>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Previous Results  -->
  <div class="row justify-content-center mt-4">
    <div class="col-12 col-xl-10">
      <div class="card soft-bg p-4">
        <!-- Tabs -->
        <ul class="nav nav-pills mb-3" id="infoTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="previous-tab" data-bs-toggle="pill" data-bs-target="#previous" type="button" role="tab" aria-controls="previous" aria-selected="true">
              üìú Previous Results
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="model-tab" data-bs-toggle="pill" data-bs-target="#model" type="button" role="tab" aria-controls="model" aria-selected="false">
              üß† Model Used
            </button>
          </li>
          <li class="ms-auto">
            <form method="post" action="{{ url_for('clear_history') }}">
              <button class="btn btn-danger btn-sm px-3" type="submit">Clear History</button>
            </form>
          </li>
        </ul>

        <div class="tab-content">
          <!-- Previous Results -->
          <div class="tab-pane fade show active" id="previous" role="tabpanel" aria-labelledby="previous-tab">
            {% if prev_results and prev_results|length > 0 %}
              <div class="table-responsive">
                <table class="table table-hover table-borderless align-middle pretty-table">
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Fuel</th>
                      <th>Seller</th>
                      <th>Trans.</th>
                      <th class="text-end">Price (l)</th>
                      <th class="text-end">Kms</th>
                      <th class="text-end">Age</th>
                      <th class="text-end">Owner</th>
                      <th class="text-center">Pred.</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for r in prev_results %}
                    <tr>
                      <td class="mono small text-muted">{{ r.time }}</td>
                      <td><span class="tag tag-fuel">{{ r.inputs.Fuel_Type }}</span></td>
                      <td><span class="tag tag-seller">{{ r.inputs.Seller_Type }}</span></td>
                      <td><span class="tag tag-trans">{{ r.inputs.Transmission }}</span></td>
                      <td class="text-end">{{ r.inputs.Present_Price }}</td>
                      <td class="text-end">{{ r.inputs.Kms_Driven }}</td>
                      <td class="text-end">{{ r.inputs.Age }}</td>
                      <td class="text-end">{{ r.inputs.Owner }}</td>
                      <td class="text-center">
                        <span class="badge rounded-pill bg-gradient-primary px-3 py-2">{{ r.prediction }}</span>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="empty-state">
                <div class="emoji">üóÇÔ∏è</div>
                <div class="title">No history yet</div>
                <div class="subtitle">Run a prediction and your results will appear here.</div>
              </div>
            {% endif %}
          </div>

          <!-- Model Used -->
          <div class="tab-pane fade" id="model" role="tabpanel" aria-labelledby="model-tab">
            <div class="d-flex flex-wrap align-items-center gap-3">
              <div class="info-chip">
                <span class="label">Model</span>
                <span class="value">{{ model_name }}</span>
              </div>
              {% if prediction is not none %}
              <div class="info-chip success">
                <span class="label">Latest Prediction</span>
                <span class="value">{{ prediction }}</span>
              </div>
              {% endif %}
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
